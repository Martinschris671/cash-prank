<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Profile - Cash App</title>
    <script src="guard.js"></script>

    <!-- Final Polished Styles -->
    <style>
      :root {
        --primary-text: #000000;
        --secondary-text: #6c6c6c;
        --background-main: #ffffff;
        --background-alt: #f0f1f2;
        --background-hover: #f5f5f5;
        --divider-color: #e5e5e5;
        --chevron-color: #8e8e93;
        --green-accent: #00d54b;
        --ripple-color: rgba(0, 0, 0, 0.1);
        --font-family: "CashMarket", -apple-system, BlinkMacSystemFont,
          sans-serif;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      @font-face {
        font-family: "CashMarket";
        font-style: normal;
        src: url(font/CashSans-Regular.otf);
        font-display: swap;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        background-color: var(--background-main);
        font-family: var(--font-family);
        margin: 0;
        color: var(--primary-text);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden;
      }
      body.modal-open {
        overflow: hidden;
      }
      a {
        text-decoration: none;
        color: inherit;
      }

      .header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 60px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 12px;
        background-color: var(--background-main);
        z-index: 1000;
      }
      .header-icons {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .header-icon-button {
        position: relative;
        overflow: hidden;
        background: none;
        border: none;
        padding: 8px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s ease-in-out;
      }

      .page-content {
        padding-top: 60px;
        width: 100%;
        max-width: 680px;
        margin: 0 auto;
        padding-bottom: 40px;
      }

      .profile-info {
        padding: 24px 20px 40px;
      }
      .profile-picture-container {
        position: relative;
        display: inline-block;
        margin-bottom: 16px;
        cursor: pointer;
        width: 90px;
        height: 90px;
      }
      .profile-picture {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        display: block;
      }
      /* NEW: Styling for Initials Div */
      .profile-initials {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background-color: var(--background-alt);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
        font-weight: 600;
        color: var(--primary-text);
        text-transform: uppercase;
      }
      .camera-icon {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 28px;
        height: 28px;
        background-color: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .profile-name {
        font-size: 24px;
        font-weight: 700;
        margin: 0;
      }
      .cashtag {
        display: inline-flex;
        align-items: center;
        background-color: var(--background-alt);
        padding: 4px 10px;
        border-radius: 14px;
        margin-top: 8px;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
      }

      .list-item {
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        text-decoration: none;
        color: inherit;
        padding: 12px 20px;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
      }
      .list-item:hover,
      .header-icon-button:hover,
      .edit-header-button:hover {
        background-color: var(--background-hover);
      }
      .list-item-icon-bg {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 16px;
        flex-shrink: 0;
      }
      .list-item-icon-bg.gray {
        background-color: var(--background-alt);
      }
      .list-item-icon-bg.green {
        background-color: var(--green-accent);
      }
      .list-item-text-container {
        flex-grow: 1;
      }
      .list-item-title {
        font-size: 16px;
        font-weight: 600;
      }
      .list-item-subtitle {
        font-size: 14px;
        color: var(--secondary-text);
        margin-top: 2px;
      }

      .divider {
        height: 1px;
        background-color: var(--divider-color);
        margin: 16px 20px;
        border: none;
      }
      .settings-title {
        font-size: 20px;
        font-weight: 700;
        margin: 0 0 8px;
        padding: 0 20px;
      }
      .settings-item-text {
        flex-grow: 1;
        margin-left: 16px;
        font-size: 16px;
        font-weight: 500;
      }

      .personal-edit-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: white;
        z-index: 4000;
        transform: translateX(100%);
        transition: transform 0.35s ease-in-out;
        display: flex;
        flex-direction: column;
      }
      .personal-edit-overlay.show {
        transform: translateX(0);
      }
      .edit-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 12px;
        height: 60px;
        border-bottom: 1px solid var(--divider-color);
        flex-shrink: 0;
      }
      .edit-header-button {
        position: relative;
        overflow: hidden;
        background: none;
        border: none;
        cursor: pointer;
        font-family: inherit;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 8px;
        border-radius: 8px;
        transition: background-color 0.2s ease-in-out;
      }
      .edit-back-btn {
        font-size: 20px;
      }
      .edit-title {
        font-size: 18px;
        font-weight: 600;
      }
      .edit-done-btn {
        font-size: 17px;
        color: var(--green-accent);
      }
      .edit-done-btn:disabled {
        color: #a0e6bb;
        cursor: not-allowed;
      }
      .edit-content {
        padding: 32px 20px;
        overflow-y: auto;
        flex-grow: 1;
        text-align: center;
      }
      .edit-profile-pic-container {
        position: relative;
        width: 100px;
        height: 100px;
        margin: 0 auto 12px;
      }
      .edit-profile-pic {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        display: block;
      }
      .edit-profile-initials {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background-color: var(--background-alt);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        font-weight: 600;
        color: var(--primary-text);
        text-transform: uppercase;
      }
      .change-photo-link {
        display: inline-block;
        color: var(--green-accent);
        font-weight: 600;
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 40px;
      }
      #edit-pic-input {
        display: none;
      }
      .input-group {
        margin-bottom: 24px;
        text-align: left;
      }
      .input-group label {
        display: block;
        font-size: 13px;
        font-weight: 600;
        color: var(--secondary-text);
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .input-group input {
        width: 100%;
        padding: 18px 16px;
        border: 1.5px solid var(--divider-color);
        border-radius: 8px;
        font-size: 16px;
        font-family: inherit;
        transition: border-color 0.2s, box-shadow 0.2s;
      }
      .input-group input:focus {
        border-color: var(--green-accent);
        outline: none;
        box-shadow: 0 0 0 3px rgba(0, 213, 75, 0.2);
      }

      /* Image-based Icon Sizing */
      .icon-img {
        display: block;
      }
      .icon-img-lg {
        width: 28px;
        height: 28px;
      }
      .icon-img-md {
        width: 26px;
        height: 26px;
      }
      .icon-img-sm {
        width: 24px;
        height: 24px;
      }
      .icon-img-xs {
        width: 20px;
        height: 20px;
      }
      .icon-camera-img {
        width: 16px;
        height: 16px;
      }

      .cashtag-chevron,
      .chevron {
        stroke: var(--chevron-color);
      }
      .ripple {
        position: absolute;
        border-radius: 50%;
        background-color: var(--ripple-color);
        transform: scale(0);
        animation: ripple-animation 600ms linear;
        pointer-events: none;
      }
      @keyframes ripple-animation {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }
      .hide {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <a href="home.html" class="header-icon-button" aria-label="Close">
        <img src="icon/close.svg" alt="Close" class="icon-img-lg" />
      </a>
      <div class="header-icons">
        <button class="header-icon-button" aria-label="QR Code">
          <img src="icon/qr-code.svg" alt="QR Code" class="icon-img-md" />
        </button>
        <button class="header-icon-button" aria-label="Upload">
          <img src="icon/upload.svg" alt="Upload" class="icon-img-md" />
        </button>
      </div>
    </header>

    <div class="page-content">
      <section class="profile-info">
        <div
          class="profile-picture-container"
          id="main-profile-picture-container"
        >
          <img
            src=""
            alt="Profile Picture"
            class="profile-picture hide"
            id="main-profile-pic"
          />
          <div class="profile-initials hide" id="main-profile-initials"></div>
          <div class="camera-icon">
            <img
              src="icon/camera.svg"
              alt="Change Photo"
              class="icon-camera-img"
            />
          </div>
        </div>
        <h1 class="profile-name" id="main-profile-name"></h1>
        <div class="cashtag" id="main-cashtag-container">
          <span id="main-cashtag"></span>
          <svg
            class="cashtag-chevron"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="margin-left: 4px"
          >
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
      </section>

      <!-- ACTION LINKS -->
      <a href="#" class="list-item edit-profile-trigger">
        <div class="list-item-icon-bg gray">
          <img src="icon/edit.svg" alt="" class="icon-img-xs" />
        </div>
        <div class="list-item-text-container">
          <div class="list-item-title">Edit profile</div>
          <div class="list-item-subtitle">Update your profile info</div>
        </div>
        <svg
          class="chevron"
          viewBox="0 0 24 24"
          fill="none"
          stroke-width="3"
          stroke-linecap="round"
          stroke-linejoin="round"
          style="width: 20px; height: 20px"
        >
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
      <a href="#" class="list-item">
        <div class="list-item-icon-bg green">
          <img
            src="icon/add.svg"
            alt=""
            class="icon-img-xs"
            style="filter: brightness(0) invert(1)"
          />
        </div>
        <div class="list-item-text-container">
          <div class="list-item-title">Invite friends</div>
          <div class="list-item-subtitle">Get $15</div>
        </div>
        <svg
          class="chevron"
          viewBox="0 0 24 24"
          fill="none"
          stroke-width="3"
          stroke-linecap="round"
          stroke-linejoin="round"
          style="width: 20px; height: 20px"
        >
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>

      <hr class="divider" />

      <main>
        <h2 class="settings-title">Account & settings</h2>
        <nav>
          <!-- The "Personal" link now also triggers the edit overlay -->
          <a href="#" class="list-item edit-profile-trigger">
            <img
              src="icon/personal.svg"
              alt=""
              class="icon-img-sm"
              style="margin-left: -2px"
            />
            <span class="settings-item-text">Personal</span>
            <svg
              class="chevron"
              viewBox="0 0 24 24"
              fill="none"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="width: 20px; height: 20px"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
          <a href="#" class="list-item">
            <img
              src="icon/bank.svg"
              alt=""
              class="icon-img-sm"
              style="margin-left: -2px"
            />
            <span class="settings-item-text">Linked banks</span>
            <svg
              class="chevron"
              viewBox="0 0 24 24"
              fill="none"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="width: 20px; height: 20px"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
          <a href="#" class="list-item">
            <img src="icon/linked-apps.svg" alt="" class="icon-img-sm" />
            <span class="settings-item-text">Linked apps & businesses</span>
            <svg
              class="chevron"
              viewBox="0 0 24 24"
              fill="none"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="width: 20px; height: 20px"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
          <a href="#" class="list-item">
            <img src="icon/shield.svg" alt="" class="icon-img-sm" />
            <span class="settings-item-text">Security & privacy</span>
            <svg
              class="chevron"
              viewBox="0 0 24 24"
              fill="none"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="width: 20px; height: 20px"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
          <a href="#" class="list-item">
            <img src="icon/star.svg" alt="" class="icon-img-sm" />
            <span class="settings-item-text">Favorites</span>
            <svg
              class="chevron"
              viewBox="0 0 24 24"
              fill="none"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="width: 20px; height: 20px"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
          <a href="#" class="list-item">
            <img src="icon/limits.svg" alt="" class="icon-img-sm" />
            <span class="settings-item-text">Limits</span>
            <svg
              class="chevron"
              viewBox="0 0 24 24"
              fill="none"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="width: 20px; height: 20px"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
          <a href="#" class="list-item">
            <img src="icon/notifications.svg" alt="" class="icon-img-sm" />
            <span class="settings-item-text">Notifications</span>
            <svg
              class="chevron"
              viewBox="0 0 24 24"
              fill="none"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="width: 20px; height: 20px"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
          <a href="#" class="list-item">
            <img src="icon/theme.svg" alt="" class="icon-img-sm" />
            <span class="settings-item-text">Theme</span>
            <svg
              class="chevron"
              viewBox="0 0 24 24"
              fill="none"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="width: 20px; height: 20px"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
          <a href="support.html" class="list-item">
            <img src="icon/support.svg" alt="" class="icon-img-sm" />
            <span class="settings-item-text">Support</span>
            <svg
              class="chevron"
              viewBox="0 0 24 24"
              fill="none"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="width: 20px; height: 20px"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
        </nav>
      </main>
    </div>

    <div class="personal-edit-overlay" id="personal-edit-overlay">
      <header class="edit-header">
        <button
          class="edit-header-button edit-back-btn"
          id="edit-back-btn"
          aria-label="Back"
        >
          <img src="icon/back-chevron.svg" alt="Back" class="icon-img-md" />
        </button>
        <h2 class="edit-title">Personal</h2>
        <button
          class="edit-header-button edit-done-btn"
          id="edit-done-btn"
          disabled
        >
          Done
        </button>
      </header>
      <main class="edit-content">
        <div class="edit-profile-pic-container">
          <img
            src=""
            alt="Edit Profile Picture"
            class="edit-profile-pic hide"
            id="edit-profile-pic"
          />
          <div
            class="edit-profile-initials hide"
            id="edit-profile-initials"
          ></div>
        </div>
        <span class="change-photo-link">Change Photo</span>
        <input type="file" id="edit-pic-input" accept="image/*" />
        <div class="input-group">
          <label for="edit-full-name">Full Name</label>
          <input type="text" id="edit-full-name" />
        </div>
        <div class="input-group">
          <label for="edit-cashtag">$Cashtag</label>
          <input type="text" id="edit-cashtag" />
        </div>
        <div class="input-group">
          <label for="edit-account-number">Account Number</label>
          <input type="text" id="edit-account-number" />
        </div>
        <div class="input-group">
          <label for="edit-routing-number">Routing Number</label>
          <input type="text" id="edit-routing-number" />
        </div>
      </main>
    </div>

    <script>
      // RIPPLE EFFECT SCRIPT
      document
        .querySelectorAll(
          ".header-icon-button, .list-item, .edit-header-button, #main-profile-picture-container, #main-cashtag-container"
        )
        .forEach((element) => {
          element.addEventListener("mousedown", function (e) {
            const rect = this.getBoundingClientRect();
            const ripple = document.createElement("span");
            ripple.className = "ripple";
            ripple.style.height = ripple.style.width =
              Math.max(rect.width, rect.height) + "px";
            this.appendChild(ripple);
            const top = e.clientY - rect.top - ripple.offsetHeight / 2;
            const left = e.clientX - rect.left - ripple.offsetWidth / 2;
            ripple.style.top = top + "px";
            ripple.style.left = left + "px";
            setTimeout(() => {
              ripple.remove();
            }, 600);
          });
        });

      // ADVANCED FUNCTIONAL SCRIPT
      const userProfileKey = "cashAppUserProfile";
      let userProfile = {};

      // DOM Elements
      const mainProfilePic = document.getElementById("main-profile-pic");
      const mainProfileInitials = document.getElementById(
        "main-profile-initials"
      );
      const mainProfileName = document.getElementById("main-profile-name");
      const mainCashtag = document.getElementById("main-cashtag");

      const editProfileTriggers = document.querySelectorAll(
        ".edit-profile-trigger"
      );
      const personalEditOverlay = document.getElementById(
        "personal-edit-overlay"
      );
      const editBackBtn = document.getElementById("edit-back-btn");
      const editDoneBtn = document.getElementById("edit-done-btn");

      const editProfilePic = document.getElementById("edit-profile-pic");
      const editProfileInitials = document.getElementById(
        "edit-profile-initials"
      );
      const editPicInput = document.getElementById("edit-pic-input");
      const changePhotoLink = document.querySelector(".change-photo-link");

      const editFullName = document.getElementById("edit-full-name");
      const editCashtag = document.getElementById("edit-cashtag");
      const editAccountNumber = document.getElementById("edit-account-number");
      const editRoutingNumber = document.getElementById("edit-routing-number");

      const mainProfilePicContainer = document.getElementById(
        "main-profile-picture-container"
      );
      const mainCashtagContainer = document.getElementById(
        "main-cashtag-container"
      );

      const generateInitials = (name) => {
        if (!name) return "";
        const parts = name.split(" ");
        return parts
          .map((part) => part[0])
          .join("")
          .toUpperCase();
      };

      const saveProfile = () =>
        localStorage.setItem(userProfileKey, JSON.stringify(userProfile));

      const updateMainUI = () => {
        mainProfileName.textContent = userProfile.fullName;
        mainCashtag.textContent = `$${userProfile.cashtag}`;

        if (userProfile.profilePic) {
          mainProfilePic.src = userProfile.profilePic;
          mainProfilePic.classList.remove("hide");
          mainProfileInitials.classList.add("hide");
        } else {
          mainProfileInitials.textContent = generateInitials(
            userProfile.fullName
          );
          mainProfileInitials.classList.remove("hide");
          mainProfilePic.classList.add("hide");
        }
      };

      const updateEditUI = () => {
        editFullName.value = userProfile.fullName;
        editCashtag.value = userProfile.cashtag;
        editAccountNumber.value = userProfile.accountNumber;
        editRoutingNumber.value = userProfile.routingNumber;

        if (userProfile.profilePic) {
          editProfilePic.src = userProfile.profilePic;
          editProfilePic.classList.remove("hide");
          editProfileInitials.classList.add("hide");
        } else {
          editProfileInitials.textContent = generateInitials(
            userProfile.fullName
          );
          editProfileInitials.classList.remove("hide");
          editProfilePic.classList.add("hide");
        }
      };

      const openEditOverlay = () => {
        updateEditUI();
        editDoneBtn.disabled = true;
        personalEditOverlay.classList.add("show");
        document.body.classList.add("modal-open");
      };

      const closeEditOverlay = () => {
        personalEditOverlay.classList.remove("show");
        document.body.classList.remove("modal-open");
      };

      const handleSaveChanges = () => {
        userProfile.fullName = editFullName.value;
        userProfile.cashtag = editCashtag.value;
        userProfile.accountNumber = editAccountNumber.value;
        userProfile.routingNumber = editRoutingNumber.value;
        saveProfile();
        updateMainUI();
        closeEditOverlay();
      };

      const loadProfile = async () => {
        const savedProfile = localStorage.getItem(userProfileKey);
        if (savedProfile) {
          userProfile = JSON.parse(savedProfile);
        } else {
          try {
            const response = await fetch(
              "https://randomuser.me/api/?inc=name&nat=us,gb"
            );
            const data = await response.json();
            const { first, last } = data.results[0].name;
            userProfile = {
              fullName: `${first} ${last}`,
              cashtag: `${first.toLowerCase()}${last
                .toLowerCase()
                .slice(0, 4)}`,
              accountNumber: `••••${Math.floor(1000 + Math.random() * 9000)}`,
              routingNumber: `••••${Math.floor(1000 + Math.random() * 9000)}`,
              profilePic: "", // Start with no picture to show initials
            };
          } catch (error) {
            console.error(
              "Failed to fetch random name, using fallback.",
              error
            );
            userProfile = {
              fullName: "Alex Ray",
              cashtag: "alexray",
              accountNumber: "••••1234",
              routingNumber: "••••5678",
              profilePic: "",
            };
          }
          saveProfile();
        }
        updateMainUI();
      };

      // --- EVENT LISTENERS ---
      editProfileTriggers.forEach((trigger) => {
        trigger.addEventListener("click", (e) => {
          e.preventDefault();
          openEditOverlay();
        });
      });
      mainProfilePicContainer.addEventListener("click", (e) => {
        e.preventDefault();
        openEditOverlay();
      });
      mainCashtagContainer.addEventListener("click", (e) => {
        e.preventDefault();
        openEditOverlay();
      });
      editBackBtn.addEventListener("click", closeEditOverlay);
      editDoneBtn.addEventListener("click", handleSaveChanges);

      [editFullName, editCashtag, editAccountNumber, editRoutingNumber].forEach(
        (input) => {
          input.addEventListener("input", () => {
            editDoneBtn.disabled = false;
          });
        }
      );

      changePhotoLink.addEventListener("click", () => {
        editPicInput.click();
      });
      editPicInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
          userProfile.profilePic = e.target.result;
          updateEditUI(); // Update the edit modal's picture instantly
          editDoneBtn.disabled = false;
        };
        reader.readAsDataURL(file);
      });

      document.addEventListener("DOMContentLoaded", loadProfile);
    </script>
  </body>
</html>
