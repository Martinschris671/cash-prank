<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment Interface</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Arial, sans-serif;
        background-color: #000;
        color: #fff;
        height: 100vh;
        overflow: hidden;
      }

      .container {
        max-width: 400px;
        margin: 0 auto;
        height: 100vh;
        background-color: #000;
        position: relative;
        overflow-y: auto;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        border-bottom: 1px solid #333;
      }

      .close-btn {
        background: none;
        border: none;
        color: #fff;
        font-size: 32px;
        cursor: pointer;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
      }

      .amount {
        font-size: 20px;
        font-weight: 600;
        color: #fff;
      }

      .pay-btn {
        background-color: #34c759;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 16px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        opacity: 0.5;
        transition: opacity 0.2s;
      }

      .pay-btn.active {
        opacity: 1;
      }

      .form-section {
        padding: 24px;
      }

      .input-group {
        margin-bottom: 16px;
        border-bottom: 1px solid #333;
        padding-bottom: 12px;
      }

      .input-row {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .input-label {
        color: #fff;
        font-size: 16px;
        font-weight: 600;
        min-width: 30px;
      }

      .input-field {
        flex: 1;
        background: transparent;
        border: none;
        color: #fff;
        font-size: 16px;
        padding: 12px 0;
        outline: none;
      }

      .input-field::placeholder {
        color: #666;
      }

      .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: #111;
        border: 1px solid #333;
        border-radius: 8px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 100;
        display: none;
      }

      .search-results.active {
        display: block;
      }

      .search-result-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .search-result-item:hover {
        background-color: #222;
      }

      .search-result-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 14px;
        font-weight: bold;
        background-size: cover;
        background-position: center;
      }

      .search-result-info {
        flex: 1;
      }

      .search-result-name {
        color: #fff;
        font-size: 14px;
        font-weight: 500;
      }

      .search-result-cashtag {
        color: #666;
        font-size: 12px;
      }

      .loading {
        padding: 12px;
        text-align: center;
        color: #666;
      }

      .note-input {
        position: relative;
        flex: 1;
      }

      .note-icons {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .star-icon {
        color: #666;
        font-size: 12px;
      }

      .payment-method {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 0;
        margin-bottom: 16px;
        cursor: pointer;
      }

      .payment-left {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .visa-logo {
        width: 40px;
        height: 24px;
        background: #fff;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #1a1f71;
        font-size: 12px;
        font-weight: bold;
        letter-spacing: 2px;
      }

      .card-info {
        color: #fff;
        font-size: 16px;
      }

      .chevron {
        color: #666;
        font-size: 18px;
        transform: rotate(90deg);
      }

      .payment-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: flex-end;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .payment-overlay.active {
        display: flex;
        opacity: 1;
      }

      .payment-modal {
        background: #000;
        border-radius: 20px 20px 0 0;
        width: 100%;
        max-width: 400px;
        padding: 24px;
        transform: translateY(100%);
        transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      }

      .payment-overlay.active .payment-modal {
        transform: translateY(0);
      }

      .payment-modal-header {
        text-align: center;
        margin-bottom: 24px;
      }

      .payment-modal-title {
        color: #fff;
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 16px;
      }

      .payment-option {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 0;
        border-bottom: 1px solid #333;
        cursor: pointer;
      }

      .payment-option.disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .payment-option-left {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .payment-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: bold;
        position: relative;
      }

      .payment-icon.cash {
        background: #34c759;
        color: #000;
      }

      .payment-icon.cash::before {
        content: "$";
        position: relative;
        z-index: 1;
      }

      .payment-icon.visa {
        background: #fff;
        color: #1a1f71;
        font-size: 10px;
        font-weight: bold;
        letter-spacing: 1px;
      }

      .payment-option-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .payment-option-title {
        color: #fff;
        font-size: 16px;
        font-weight: 500;
      }

      .payment-option-subtitle {
        color: #666;
        font-size: 14px;
      }

      .payment-warning {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        margin: 16px 0;
        padding: 12px;
        border-radius: 8px;
      }

      .payment-warning-icon {
        color: #666;
        font-size: 16px;
        margin-top: 2px;
      }

      .payment-warning-text {
        color: #666;
        font-size: 14px;
        line-height: 1.4;
      }

      .continue-btn {
        background: #000;
        color: #fff;
        border: 2px solid #333;
        padding: 16px;
        border-radius: 25px;
        font-size: 18px;
        font-weight: 600;
        width: 100%;
        cursor: pointer;
        margin-top: 24px;
        transition: all 0.2s ease;
      }

      .radio-button {
        width: 20px;
        height: 20px;
        border: 2px solid #666;
        border-radius: 50%;
        background: transparent;
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .radio-button.selected {
        border-color: #34c759;
        background: #34c759;
      }

      .radio-button.selected::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #000;
      }

      .modal-handle {
        width: 40px;
        height: 4px;
        background: #333;
        border-radius: 2px;
        margin: 0 auto 20px;
      }

      .suggested-section {
        margin-top: 8px;
      }

      .suggested-title {
        font-size: 28px;
        font-weight: 700;
        color: #fff;
        margin-bottom: 24px;
      }

      .contact-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .contact-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 0;
        cursor: pointer;
      }

      .contact-left {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .avatar {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background-size: cover;
        background-position: center;
        background-color: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 18px;
        font-weight: bold;
      }

      .contact-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .contact-name {
        color: #fff;
        font-size: 16px;
        font-weight: 500;
      }

      .contact-handle {
        color: #666;
        font-size: 14px;
      }

      .checkbox {
        width: 20px;
        height: 20px;
        border: 2px solid #666;
        border-radius: 6px;
        background: transparent;
        cursor: pointer;
        position: relative;
        appearance: none;
      }

      .checkbox:checked {
        background-color: #34c759;
        border-color: #34c759;
      }

      .checkbox:checked::after {
        content: "✓";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #000;
        font-size: 12px;
        font-weight: bold;
      }

      .search-container {
        position: relative;
      }

      .suggested-contacts {
        height: 400px;
        overflow-y: auto;
        padding-right: 8px;
      }

      .suggested-contacts::-webkit-scrollbar {
        width: 4px;
      }

      .suggested-contacts::-webkit-scrollbar-track {
        background: #111;
      }

      .suggested-contacts::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 2px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <button class="close-btn">×</button>
        <div class="amount">$1,000</div>
        <button class="pay-btn" id="payBtn">Pay</button>
      </div>

      <div class="form-section">
        <div class="input-group">
          <div class="input-row">
            <label class="input-label">To</label>
            <div class="search-container">
              <input
                type="text"
                class="input-field"
                id="searchInput"
                placeholder="Name, $Cashtag, Phone, Email"
              />
              <div class="search-results" id="searchResults"></div>
            </div>
          </div>
        </div>

        <div class="input-group">
          <div class="input-row">
            <label class="input-label">For</label>
            <div class="note-input">
              <input
                type="text"
                class="input-field"
                placeholder="Note (required)"
              />
              <div class="note-icons">
                <span class="star-icon">✦</span>
              </div>
            </div>
          </div>
        </div>

        <div class="input-group">
          <div class="payment-method">
            <div class="payment-left">
              <div class="input-label">Use</div>
              <div class="visa-logo">VISA</div>
              <div class="card-info">Visa debit card 4042</div>
            </div>
            <div class="chevron">⌄</div>
          </div>
        </div>

        <div class="suggested-section">
          <div class="suggested-title">Suggested</div>
          <div class="suggested-contacts">
            <div class="contact-list" id="suggestedContacts">
              <!-- Contacts will be populated here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Method Selection Overlay -->
    <div class="payment-overlay" id="paymentOverlay">
      <div class="payment-modal">
        <div class="modal-handle"></div>
        <div class="payment-modal-header">
          <div class="payment-modal-title">
            How would you like to fund this payment?
          </div>
        </div>

        <div class="payment-option disabled">
          <div class="payment-option-left">
            <div class="payment-icon cash"></div>
            <div class="payment-option-info">
              <div class="payment-option-title">Cash balance</div>
              <div class="payment-option-subtitle">$0</div>
            </div>
          </div>
          <div class="radio-button"></div>
        </div>

        <div class="payment-warning">
          <div class="payment-warning-icon">ⓘ</div>
          <div class="payment-warning-text">
            Your Cash balance can't cover the full amount. Choose another
            payment method.
          </div>
        </div>

        <div class="payment-option" id="visaOption">
          <div class="payment-option-left">
            <div class="payment-icon visa">VISA</div>
            <div class="payment-option-info">
              <div class="payment-option-title">Debit card 4042</div>
              <div class="payment-option-subtitle">Debit Card 4042</div>
            </div>
          </div>
          <div class="radio-button selected"></div>
        </div>

        <button class="continue-btn" id="continueBtn">Continue</button>
      </div>
    </div>

    <script>
      const payBtn = document.getElementById("payBtn");
      const inputs = document.querySelectorAll(".input-field");
      const paymentOverlay = document.getElementById("paymentOverlay");
      const paymentMethod = document.querySelector(".payment-method");
      const continueBtn = document.getElementById("continueBtn");
      const visaOption = document.getElementById("visaOption");
      const searchInput = document.getElementById("searchInput");
      const searchResults = document.getElementById("searchResults");
      const suggestedContacts = document.getElementById("suggestedContacts");
      let searchTimeout;
      let selectedContact = null;

      // Suggested contacts data
      const suggestedContactsData = [
        { name: "Max", cashtag: "$fogwraith", initial: "M", color: "#666" },
        {
          name: "Brandon Johnson",
          cashtag: "$blackgoalith510",
          initial: "B",
          color: "#333",
        },
        { name: "Rockey", cashtag: "$J1brael", initial: "R", color: "#4A90E2" },
        {
          name: "Money Mike",
          cashtag: "$Rackzzmafíaa",
          initial: "M",
          color: "#228B22",
        },
        { name: "Punchess", cashtag: "$Gwmv", initial: "P", color: "#4A90E2" },
        { name: "solo", cashtag: "$viaswípes", initial: "S", color: "#D2691E" },
        { name: "Alex", cashtag: "$alexcash", initial: "A", color: "#FF6B6B" },
        { name: "Sarah", cashtag: "$sarahpay", initial: "S", color: "#4ECDC4" },
        { name: "Mike", cashtag: "$mikemoney", initial: "M", color: "#45B7D1" },
        { name: "Lisa", cashtag: "$lisacash", initial: "L", color: "#96CEB4" },
      ];

      // Load suggested contacts from real Cash App profiles
      async function loadSuggestedContacts() {
        const contactsHTML = await Promise.all(
          suggestedContactsData.map(async (contact) => {
            const profile = await scrapeCashAppProfile(contact.cashtag);
            const avatarStyle =
              profile && profile.pfp
                ? `background-image: url('${profile.pfp}');`
                : `background-color: ${contact.color};`;
            const displayName = profile ? profile.name : contact.name;

            return `
                    <div class="contact-item" data-cashtag="${contact.cashtag}">
                        <div class="contact-left">
                            <div class="avatar" style="${avatarStyle}">
                                ${profile && profile.pfp ? "" : contact.initial}
                            </div>
                            <div class="contact-info">
                                <div class="contact-name">${displayName}</div>
                                <div class="contact-handle">${
                                  contact.cashtag
                                }</div>
                            </div>
                        </div>
                        <input type="checkbox" class="checkbox">
                    </div>
                `;
          })
        );

        suggestedContacts.innerHTML = contactsHTML.join("");
        attachContactListeners();
      }

      // Real Cash App profile scraping
      async function scrapeCashAppProfile(cashtag) {
        try {
          const cleanCashtag = cashtag.replace("$", "");
          const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(
            `https://cash.app/${cleanCashtag}`
          )}`;

          const response = await fetch(proxyUrl);
          const text = await response.text();

          // Extract name from meta tags or title
          const nameMatch =
            text.match(/<title[^>]*>([^<]*)<\/title>/i) ||
            text.match(
              /<meta[^>]*property="og:title"[^>]*content="([^"]*)"[^>]*>/i
            ) ||
            text.match(
              /<meta[^>]*name="twitter:title"[^>]*content="([^"]*)"[^>]*>/i
            );

          // Extract profile image
          const imageMatch =
            text.match(
              /<meta[^>]*property="og:image"[^>]*content="([^"]*)"[^>]*>/i
            ) ||
            text.match(
              /<meta[^>]*name="twitter:image"[^>]*content="([^"]*)"[^>]*>/i
            );

          let name = cashtag;
          if (nameMatch && nameMatch[1]) {
            name = nameMatch[1].replace(/\s*\|\s*Cash App.*$/i, "").trim();
          }

          return {
            name: name || cashtag,
            cashtag: cashtag,
            pfp: imageMatch && imageMatch[1] ? imageMatch[1] : null,
          };
        } catch (error) {
          console.error("Error scraping profile:", error);
          return null;
        }
      }

      // Search functionality
      function debounceSearch(query) {
        clearTimeout(searchTimeout);
        if (query.length < 2) {
          searchResults.classList.remove("active");
          return;
        }

        searchTimeout = setTimeout(async () => {
          if (query.startsWith("$")) {
            searchResults.innerHTML = '<div class="loading">Loading...</div>';
            searchResults.classList.add("active");

            const profile = await scrapeCashAppProfile(query);

            if (profile) {
              const avatarStyle = profile.pfp
                ? `background-image: url('${profile.pfp}');`
                : `background-color: #333;`;
              const avatarText = profile.pfp
                ? ""
                : profile.name.charAt(0).toUpperCase();

              searchResults.innerHTML = `
                            <div class="search-result-item" data-name="${profile.name}" data-cashtag="${profile.cashtag}">
                                <div class="search-result-avatar" style="${avatarStyle}">
                                    ${avatarText}
                                </div>
                                <div class="search-result-info">
                                    <div class="search-result-name">${profile.name}</div>
                                    <div class="search-result-cashtag">${profile.cashtag}</div>
                                </div>
                            </div>
                        `;

              document
                .querySelector(".search-result-item")
                .addEventListener("click", function () {
                  const name = this.getAttribute("data-name");
                  const cashtag = this.getAttribute("data-cashtag");
                  searchInput.value = `${name} ${cashtag}`;
                  searchResults.classList.remove("active");
                  selectedContact = { name, cashtag };
                  updatePayButton();
                });
            } else {
              searchResults.innerHTML =
                '<div class="loading">Profile not found</div>';
            }
          } else {
            searchResults.classList.remove("active");
          }
        }, 500);
      }

      // Attach listeners to contact items
      function attachContactListeners() {
        const contactItems = document.querySelectorAll(".contact-item");
        contactItems.forEach((item) => {
          item.addEventListener("click", function () {
            const cashtag = this.getAttribute("data-cashtag");
            const name = this.querySelector(".contact-name").textContent;
            searchInput.value = `${name} ${cashtag}`;

            // Clear all checkboxes
            document
              .querySelectorAll(".checkbox")
              .forEach((cb) => (cb.checked = false));

            // Check current checkbox
            const checkbox = this.querySelector(".checkbox");
            checkbox.checked = true;

            selectedContact = { name, cashtag };
            updatePayButton();
          });
        });
      }

      // Update pay button state
      function updatePayButton() {
        const hasSelectedContact = selectedContact !== null;
        const noteField = document.querySelector(
          'input[placeholder="Note (required)"]'
        );
        const hasNote = noteField.value.trim() !== "";

        if (hasSelectedContact && hasNote) {
          payBtn.classList.add("active");
        } else {
          payBtn.classList.remove("active");
        }
      }

      // Event listeners
      searchInput.addEventListener("input", function () {
        debounceSearch(this.value);
      });

      document.addEventListener("click", function (e) {
        if (!e.target.closest(".search-container")) {
          searchResults.classList.remove("active");
        }
      });

      inputs.forEach((input) => {
        input.addEventListener("input", updatePayButton);
      });

      document
        .querySelector(".close-btn")
        .addEventListener("click", function () {
          console.log("Closing interface");
        });

      payBtn.addEventListener("click", function () {
        if (this.classList.contains("active")) {
          console.log("Payment initiated");
        }
      });

      paymentMethod.addEventListener("click", function () {
        paymentOverlay.style.display = "flex";
        setTimeout(() => {
          paymentOverlay.classList.add("active");
        }, 10);
      });

      paymentOverlay.addEventListener("click", function (e) {
        if (e.target === paymentOverlay) {
          closeModal();
        }
      });

      function closeModal() {
        paymentOverlay.classList.remove("active");
        setTimeout(() => {
          paymentOverlay.style.display = "none";
        }, 300);
      }

      continueBtn.addEventListener("click", function () {
        closeModal();
      });

      // Initialize
      loadSuggestedContacts();
      searchInput.focus();
    </script>
  </body>
</html>
