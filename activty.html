<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Activity - Cash App</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="guard.js"></script>
    <style>
      @font-face {
        font-family: "CashMarket";
        font-style: normal;
        src: url(font/CashSans-Regular.otf);
        font-display: swap;
      }
      /* ======================================= */
      /* --- LIGHT THEME (DEFAULT) --- */
      /* ======================================= */
      :root {
        --header-height: 65px;
        --padding-screen: 18px;
        --app-bg-color: #ffffff;
        --app-bg-secondary: #f3f3f3;
        --text-primary: #000000;
        --text-secondary: #6c757d;
        --text-secondary-timestamp: #8a8a8e;
        --border-color-light: #e9ecef;
        --divider-color: #e5e5ea;
        --border-radius-card: 12px;
        --accent-green: #00d54b;
        --accent-red: #ff3b30;
        --font-family: "CashMarket", -apple-system, BlinkMacSystemFont,
          sans-serif;
      }
      /* ======================================= */
      /* --- DARK THEME --- */
      /* ======================================= */
      [data-theme="dark"] {
        --app-bg-color: #000000;
        --app-bg-secondary: #1c1c1e;
        --text-primary: #ffffff;
        /* --text-secondary remains greyish in dark mode */
        --text-secondary-timestamp: #8a8a8e;
        --border-color-light: #2c2c2e;
        --divider-color: #2c2c2e;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: var(--font-family);
        background-color: var(--app-bg-color);
        color: var(--text-primary);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      a {
        text-decoration: none;
        color: inherit;
      }
      .activity-container {
        max-width: 450px;
        width: 100%;
        height: 100%;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        position: relative;
      }
      .activity-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px var(--padding-screen);
        height: var(--header-height);
        flex-shrink: 0;
      }
      .activity-header h1 {
        font-size: 23px;
        font-weight: 600;
      }
      .profile-icon-link {
        display: block;
        width: 27px;
        height: 27px;
      }
      .profile-icon {
        font-size: 16px;
        color: var(--text-secondary);
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background-color: var(--app-bg-secondary);
        display: flex;
        align-items: center;
        justify-content: center;
        object-fit: cover;
      }
      .search-bar-container {
        padding: 0 var(--padding-screen) 10px;
        flex-shrink: 0;
      }
      .search-bar {
        display: flex;
        align-items: center;
        gap: 8px;
        background-color: var(--app-bg-secondary);
        border-radius: 20px;
        padding: 10px;
      }
      .search-bar i {
        color: var(--text-secondary);
      }
      .search-bar input {
        flex-grow: 1;
        border: none;
        background: none;
        outline: none;
        font-size: 16px;
        color: var(--text-primary);
      }
      .search-bar input::placeholder {
        color: var(--text-secondary);
      }
      .quick-actions {
        display: flex;
        gap: 12px;
        padding: 0px var(--padding-screen);
        padding-bottom: 10px;
        flex-shrink: 0;
        overflow-x: auto;
        white-space: nowrap;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .quick-actions::-webkit-scrollbar {
        display: none;
      }
      .quick-action {
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
      .quick-action-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        color: white;
        flex-shrink: 0;
      }
      .quick-action-icon.green {
        background-color: white;
        color: #000;
        border: 1px solid #000;
      }
      [data-theme="dark"] .quick-action-icon.green {
        background-color: transparent;
        color: #000;
        border: 1px solid #ffffff;
      }
      .quick-action-icon.green svg path {
        stroke: var(--text-primary);
      }
      .quick-action-icon img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
      }
      .quick-action-label {
        font-size: 14px;
        font-weight: 500;
        max-width: 60px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .activity-list-container {
        flex-grow: 1;
        overflow-y: auto;
        padding-bottom: 65px;
      }
      .date-group-header {
        padding: 18px var(--padding-screen) 8px;
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
      }
      .transaction-list {
        list-style: none;
        background-color: var(--app-bg-color);
      }
      .transaction-item {
        display: flex;
        padding: 12px var(--padding-screen);
        cursor: pointer;
        transition: height 0.3s ease, opacity 0.3s ease, transform 0.3s ease;
      }
      .transaction-item.deleting {
        transform: translateX(-100%);
        opacity: 0;
      }
      .transaction-avatar {
        width: 46px;
        height: 46px;
        border-radius: 50%;
        margin-right: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: 600;
        color: white;
        object-fit: cover;
        flex-shrink: 0;
        transform: translatey(5px);
      }
      .transaction-details {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .transaction-name {
        font-size: 14px;
        font-weight: 600;
      }
      .transaction-status {
        font-size: 13px;
        color: var(--text-secondary);
        margin-top: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .transaction-time {
        font-size: 13px;
        color: var(--text-secondary);
      }
      .transaction-amount {
        font-size: 14px;
        font-weight: 600;
        text-align: right;
      }
      .empty-state {
        text-align: center;
        padding: 10vh var(--padding-screen);
      }
      .empty-state h2 {
        font-size: 22px;
        font-weight: 600;
      }
      .empty-state p {
        font-size: 16px;
        color: var(--text-secondary);
        margin-top: 8px;
        margin-bottom: 30px;
      }
      /* TRANSACTION DETAILS OVERLAY STYLES */
      .details-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--app-bg-color);
        color: var(--text-primary);
        z-index: 4000;
        transform: translateX(100%);
        transition: transform 0.35s ease-in-out;
        display: flex;
        justify-content: center;
        align-items: flex-start;
      }
      .details-overlay.show {
        transform: translateX(0);
      }
      .details-inner-container {
        background-color: var(--app-bg-color);
        width: 100%;
        max-width: 450px;
        height: 100%;
        overflow-y: auto;
        position: relative;
        display: flex;
        flex-direction: column;
      }
      .details-header {
        position: sticky;
        top: 0;
        background-color: var(--app-bg-color);
        z-index: 10;
        padding: 16px 20px;
        display: flex;
        align-items: center;
      }
      .details-close-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .details-close-btn .themeable-icon {
        width: 24px;
        height: 24px;
      }
      .details-content {
        flex-grow: 1;
        padding: 0 20px 0px;
      }
      .td-recipient-info {
        padding-top: 0px;
        padding-bottom: 10px;
        text-align: left;
      }
      .td-avatar {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        font-weight: 600;
        color: white;
      }
      .td-recipient-name {
        font-size: 28px;
        font-weight: 700;
        margin: 0;
        line-height: 1.2;
      }
      .td-timestamp,
      .td-note {
        font-size: 15px;
        color: var(--text-secondary-timestamp);
        margin: 4px 0 0 0;
        line-height: 1.4;
        font-weight: 400;
      }
      .td-note .td-emoji {
        font-size: 13px;
        margin-left: 2px;
        vertical-align: middle;
      }
      .td-amount {
        font-size: 44px;
        font-weight: 700;
        text-align: left;
        margin: 0;
        padding-bottom: 5px;
      }
      .td-divider {
        height: 1px;
        border: none;
        background-color: var(--divider-color);
        margin: 20px 0;
      }
      .td-list-section {
        padding-top: 0px;
      }
      .td-list-header {
        font-size: 17px;
        font-weight: 700;
        margin: 0 0 25px 0;
      }
      .td-detail-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 28px;
      }
      .td-detail-item:last-child {
        margin-bottom: 0;
      }
      .td-icon {
        flex-shrink: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 18px;
        color: var(--text-primary);
        font-size: 22px;
        font-weight: 500;
      }
      .td-text-content {
        flex-grow: 1;
      }
      .td-title {
        font-size: 17px;
        font-weight: 700;
        margin: 0 0 2px 0;
        line-height: 1.4;
      }
      .td-subtitle {
        font-size: 17px;
        font-weight: 400;
        color: var(--text-secondary-timestamp);
        margin: 0;
        line-height: 1.4;
      }
      .td-icon-right {
        flex-shrink: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .td-actions-section {
        padding-top: 0px;
      }
      .td-actions-header {
        font-size: 17px;
        font-weight: 700;
        margin: 0 0 25px 0;
      }
      .td-action-item {
        display: flex;
        align-items: center;
        margin-bottom: 28px;
        cursor: pointer;
      }
      .td-action-item:last-child {
        margin-bottom: 0;
      }
      .td-action-icon {
        flex-shrink: 0;
        width: 24px;
        height: 24px;
        margin-right: 18px;
      }
      .td-action-label {
        flex-grow: 1;
        font-size: 17px;
        font-weight: 500;
        line-height: 1.2;
      }
      .td-action-chevron {
        width: 16px;
        height: 16px;
      }
      .td-action-chevron svg {
        width: 100%;
        height: 100%;
        fill: var(--text-secondary);
      }
      .td-footer-info {
        padding: 25px 0;
        border-top: 1px solid var(--divider-color);
        color: var(--text-secondary-timestamp);
        font-size: 14px;
        line-height: 1.5;
        margin-top: 25px;
      }
      .td-footer-info p {
        margin: 0;
      }
      .td-footer-button-wrapper {
        position: sticky;
        bottom: 0;
        background: var(--app-bg-color);
        padding: 16px 0;
        margin-top: 20px;
      }
      .td-cancel-button {
        width: 100%;
        background-color: var(--accent-green);
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 18px;
        font-weight: 600;
        padding: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-family: var(--font-family);
      }
      .td-cancel-button .themeable-icon {
        width: 24px;
        height: 24px;
      }
      [data-theme="dark"] .td-cancel-button {
        color: black;
      }

      /* BOTTOM NAV */
      .bottom-nav {
        display: flex;
        justify-content: space-around;
        align-items: center;
        border-top: 1px solid var(--border-color-light);
        background-color: var(--app-bg-color);
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 65px;
        padding: 0 var(--padding-screen);
        z-index: 200;
      }
      .nav-button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: inherit;
        font-weight: 600;
        color: var(--text-secondary);
        min-width: 44px;
      }
      .nav-button svg {
        fill: var(--text-secondary);
      }
      .nav-button.active,
      .nav-button.active svg {
        color: var(--text-primary);
        fill: var(--text-primary);
      }
      #nav-balance-display {
        font-size: 16px;
      }

      /* ======================================= */
      /* --- START: THEMEABLE ICON CSS --- */
      /* ======================================= */
      .themeable-icon {
        width: 100%;
        height: 100%;
        background-color: var(
          --text-primary
        ); /* Default color is the primary text color */

        /* The magic part: Use the icon as a mask */
        -webkit-mask-image: var(--icon-url);
        mask-image: var(--icon-url);
        -webkit-mask-size: contain;
        mask-size: contain;
        -webkit-mask-repeat: no-repeat;
        mask-repeat: no-repeat;
        -webkit-mask-position: center;
        mask-position: center;
      }
      /* --- Specific Theme Classes (for overrides) --- */
      .themeable-icon.white {
        background-color: #ffffff;
      }
      .themeable-icon.black {
        background-color: #000000;
      }
      /* --- Icon color in dark mode for specific cases --- */
      [data-theme="dark"] .td-icon-right .themeable-icon {
        background-color: var(--text-secondary);
      }
      /* ======================================= */
      /* --- END: THEMEABLE ICON CSS --- */
      /* ======================================= */
    </style>
    <!-- 👇 PASTE THIS SCRIPT BLOCK HERE 👇 -->
    <script>
      // This script runs instantly to prevent a theme flicker.
      (function () {
        // Get the saved theme from localStorage, defaulting to 'system'.
        let theme =
          window.localStorage.getItem("app-theme-preference") || "system";

        // If the theme is 'system', determine the actual theme from the user's OS settings.
        if (theme === "system") {
          theme = window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light";
        }

        // Apply the determined theme to the <html> element.
        document.documentElement.setAttribute("data-theme", theme);
      })();
    </script>
    <!-- 👆 END OF ANTI-FLICKER SCRIPT 👆 -->
  </head>
  <body>
    <div class="activity-container">
      <header class="activity-header">
        <h1>Activity</h1>
        <a href="profile.html" class="profile-icon-link"></a>
      </header>
      <div class="search-bar-container">
        <div class="search-bar">
          <i class="fa-solid fa-magnifying-glass"></i
          ><input
            type="text"
            id="search-input"
            placeholder="Search transactions"
          />
        </div>
      </div>
      <div class="quick-actions" id="quick-actions-container"></div>
      <div class="activity-list-container" id="activity-list-container"></div>
      <nav class="bottom-nav">
        <a href="home.html"
          ><button
            class="nav-button"
            id="nav-balance-display"
            aria-label="Home"
          ></button
        ></a>
        <a href="card.html"
          ><button class="nav-button" aria-label="Cards">
            <svg width="22" height="18" viewBox="0 0 24 21">
              <path
                transform="translate(-126.25 -18)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M131.25 21H145.25C146.355 21 147.25 21.8954 147.25 23V33C147.25 34.1046 146.355 35 145.25 35H131.25C130.145 35 129.25 34.1046 129.25 33V23C129.25 21.8954 130.145 21 131.25 21ZM126.25 23C126.25 20.2386 128.489 18 131.25 18H145.25C148.011 18 150.25 20.2386 150.25 23V33C150.25 35.7614 148.011 38 145.25 38H131.25C128.489 38 126.25 35.7614 126.25 33V23ZM134.25 24C133.145 24 132.25 24.8954 132.25 26C132.25 27.1046 133.145 28 134.25 28H135.25C136.355 28 137.25 27.1046 137.25 26C137.25 24.8954 136.355 24 135.25 24H134.25Z"
              />
            </svg></button
        ></a>
        <a href="pay.html"
          ><button class="nav-button" aria-label="Pay">
            <svg width="14" height="20" viewBox="0 0 15 23">
              <path
                transform="translate(-205 -17)"
                d="M217.675 23.8903C217.923 24.1401 218.336 24.1401 218.569 23.8903L219.811 22.5912C220.075 22.3414 220.06 21.8917 219.782 21.6218C218.805 20.7669 217.671 20.1148 216.442 19.7032L216.835 17.8045C216.919 17.3897 216.611 17 216.199 17H213.794C213.643 17.0016 213.498 17.0551 213.382 17.1515C213.267 17.2479 213.187 17.3814 213.158 17.5296L212.81 19.2185C209.61 19.3834 206.897 21.0173 206.897 24.365C206.897 27.263 209.138 28.5071 211.508 29.3616C213.749 30.221 214.937 30.5408 214.937 31.7499C214.937 32.9941 213.754 33.7236 212.005 33.7236C210.415 33.7236 208.745 33.189 207.453 31.8848C207.393 31.8244 207.322 31.7765 207.243 31.7438C207.165 31.7111 207.081 31.6942 206.996 31.6942C206.911 31.6942 206.827 31.7111 206.748 31.7438C206.67 31.7765 206.599 31.8244 206.539 31.8848L205.197 33.2339C205.071 33.3613 205 33.5338 205 33.7136C205 33.8934 205.071 34.0659 205.197 34.1933C206.241 35.2276 207.562 35.9771 209.069 36.3918L208.701 38.1756C208.617 38.5903 208.92 38.975 209.332 38.98L211.743 39C211.895 39.0007 212.042 38.9482 212.16 38.8516C212.278 38.755 212.359 38.6202 212.388 38.4704L212.736 36.7765C216.586 36.5167 218.932 34.3831 218.932 31.2703C218.932 28.4022 216.596 27.193 213.764 26.2087C212.144 25.6041 210.743 25.1894 210.743 23.9453C210.743 22.7361 212.05 22.2564 213.361 22.2564C215.031 22.2564 216.636 22.9509 217.685 23.9003L217.675 23.8903Z"
              />
            </svg></button
        ></a>
        <a href="search.html"
          ><button class="nav-button" aria-label="Search">
            <svg width="21" height="21" viewBox="0 0 23 24">
              <path
                transform="translate(-276.25 -16.5)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M291.75 26.5C291.75 30.0899 288.84 33 285.25 33C281.66 33 278.75 30.0899 278.75 26.5C278.75 22.9101 281.66 20 285.25 20C288.84 20 291.75 22.9101 291.75 26.5ZM290.823 34.1944C289.258 35.3302 287.332 36 285.25 36C280.003 36 275.75 31.7467 275.75 26.5C275.75 21.2533 280.003 17 285.25 17C290.497 17 294.75 21.2533 294.75 26.5C294.75 28.582 294.08 30.5076 292.944 32.0731L297.882 37.0104C298.468 37.5962 298.468 38.546 297.882 39.1317C297.296 39.7175 296.346 39.7175 295.76 39.1317L290.823 34.1944Z"
              />
            </svg></button
        ></a>
        <a href="#"
          ><button class="nav-button active" aria-label="Activity">
            <svg width="22" height="22" viewBox="0 0 24 25">
              <path
                transform="translate(-349 -16)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M370 28C370 32.9706 365.971 37 361 37C356.029 37 352 32.9706 352 28C352 23.0294 356.029 19 361 19C365.971 19 370 23.0294 370 28ZM373 28C373 34.6274 367.627 40 361 40C354.373 40 349 34.6274 349 28C349 21.3726 354.373 16 361 16C367.627 16 373 21.3726 373 28ZM362.5 24C362.5 23.1716 361.828 22.5 361 22.5C360.172 22.5 359.5 23.1716 359.5 24V27.4893C359.5 28.4591 360.061 29.3414 360.939 29.753L364.363 31.3582C365.113 31.7098 366.007 31.3868 366.358 30.6367C366.71 29.8865 366.387 28.9934 365.637 28.6418L362.5 27.1715V24Z"
              />
            </svg></button
        ></a>
      </nav>
    </div>

    <div class="details-overlay" id="details-overlay"></div>

    <script>
      /* YOUR EXISTING SCRIPT - NO CHANGES MADE HERE */
      const profileIconLink = document.querySelector(".profile-icon-link");
      const quickActionsContainer = document.getElementById(
        "quick-actions-container"
      );
      const activityListContainer = document.getElementById(
        "activity-list-container"
      );
      const detailsOverlay = document.getElementById("details-overlay");
      const searchInput = document.getElementById("search-input");
      const userProfileKey = "cashAppUserProfile";
      const RANDOM_DEFAULT_ICONS = [
        "profile/IMG-20250817-WA0001.jpg",
        "profile/IMG-20250817-WA0002.jpg",
        "profile/IMG-20250817-WA0003.jpg",
        "profile/IMG-20250817-WA0004.jpg",
        "profile/IMG-20250817-WA0005.jpg",
        "profile/IMG-20250817-WA0006.jpg",
      ];
      function initializeUserProfile() {
        const randomIconPath =
          RANDOM_DEFAULT_ICONS[
            Math.floor(Math.random() * RANDOM_DEFAULT_ICONS.length)
          ];
        const newProfile = {
          fullName: "Punchmadedomo",
          profilePic: null,
          defaultProfileIcon: randomIconPath,
        };
        localStorage.setItem(userProfileKey, JSON.stringify(newProfile));
        return newProfile;
      }
      function generateProfileIcon(profile) {
        if (profile && profile.profilePic) {
          return `<img src="${profile.profilePic}" alt="Profile" class="profile-icon">`;
        }
        const imageToUse =
          profile.defaultProfileIcon || RANDOM_DEFAULT_ICONS[0];
        return `<img src="${imageToUse}" alt="Profile" class="profile-icon">`;
      }
      (contactStorageKey = "cashAppContacts"),
        (transactionsKey = "cashAppTransactions");
      const defaultContacts = [
        {
          id: 1,
          name: "Jay Z",
          cashtag: "$sc",
          avatar: "images/jayz.jpeg",
          color: "#666",
        },
        {
          id: 2,
          name: "Raul Garcia",
          cashtag: "$raul",
          avatar:
            "https://images.unsplash.com/photo-1570295999919-5ceb5ecca61?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=128&q=80",
          color: "#007bff",
        },
        {
          id: 3,
          name: "Cale Martin",
          cashtag: "$cale",
          avatar: "",
          color: "#ef4444",
        },
      ];
      const initialTransactions = [];
      const formatCurrency = (amount, sign = false) =>
        `${sign ? "+ " : ""}$${Math.abs(amount).toLocaleString("en-US", {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        })}`;
      const formatSimpleCurrency = (amount) =>
        `$${Math.abs(amount).toLocaleString("en-US")}`;
      const generateTransactionNumber = () =>
        `#D-454B${Math.floor(1000 + Math.random() * 9000)}`;
      const createThemeableIcon = (iconName, colorClass = "") => {
        return `<div class="themeable-icon ${colorClass}" style="--icon-url: url('tansicon/${iconName}');"></div>`;
      };
      function getSmartDateGroup(dateStr) {
        const date = new Date(dateStr);
        const now = new Date();
        const today = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate()
        );
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);
        if (date >= today) return "Today";
        if (date >= yesterday) return "Yesterday";
        const startOfWeek = new Date(today);
        startOfWeek.setDate(
          startOfWeek.getDate() -
            today.getDay() +
            (today.getDay() === 0 ? -6 : 1)
        );
        if (date >= startOfWeek) return "This Week";
        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
        if (date >= startOfMonth) return "This Month";
        const startOfLastMonth = new Date(
          now.getFullYear(),
          now.getMonth() - 1,
          1
        );
        if (date >= startOfLastMonth) return "Last Month";
        return date.toLocaleDateString("en-US", { month: "long" });
      }
      function renderActivity(query = "") {
        let transactions =
          JSON.parse(localStorage.getItem(transactionsKey)) ||
          initialTransactions;
        let wasModified = false;
        transactions.forEach((t) => {
          if (!t.id) {
            t.id = `tx-generated-${Math.random().toString(36).substr(2, 9)}`;
            wasModified = true;
          }
        });
        if (wasModified) {
          localStorage.setItem(transactionsKey, JSON.stringify(transactions));
        }
        if (transactions.length === 0) {
          transactions.push({
            id: `tx-pending-${Date.now()}`,
            type: "payment",
            recipient: defaultContacts[2],
            amount: 9000.0,
            status: "pending",
            date: new Date().toISOString(),
          });
          transactions.push({
            id: `tx-received-${Date.now() - 100000}`,
            type: "received",
            recipient: defaultContacts[0],
            amount: 250.0,
            status: "completed",
            date: new Date(Date.now() - 100000).toISOString(),
            note: "Thanks for the help!",
          });
          transactions.push({
            id: `tx-add-${Date.now() - 200000}`,
            type: "add",
            amount: 9000.0,
            status: "completed",
            date: new Date(Date.now() - 200000).toISOString(),
          });
          transactions.push({
            id: `tx-withdraw-${Date.now() - 300000}`,
            type: "withdraw",
            amount: 987.0,
            fee: 13.0,
            totalDeducted: 1000.0,
            status: "completed",
            date: new Date(Date.now() - 300000).toISOString(),
          });
          localStorage.setItem(transactionsKey, JSON.stringify(transactions));
        }
        transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
        const contacts =
          JSON.parse(localStorage.getItem(contactStorageKey)) ||
          defaultContacts;
        const paymentTransactions = transactions.filter(
          (t) => t.type === "payment" || t.type === "received"
        );
        const recentRecipients = [];
        const recipientIds = new Set();
        for (const t of paymentTransactions) {
          if (recentRecipients.length >= 4) break;
          const recipientId = t.recipient ? t.recipient.id : t.contactId;
          if (recipientId && !recipientIds.has(recipientId)) {
            recipientIds.add(recipientId);
            let recipient =
              t.recipient || contacts.find((c) => c.id == recipientId);
            if (recipient) {
              recentRecipients.push(recipient);
            }
          }
        }
        let quickActionsHtml = `<div class="quick-action">
      <div class="quick-action-icon green">
        <svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 100 100" aria-hidden="true" role="img">
          <path d="M 15 50 L 85 50 M 50 15 L 50 85" fill="none" stroke-width="12" stroke-linecap="butt"/>
        </svg>
      </div>
      <span class="quick-action-label">Get $5</span>
    </div>`;
        recentRecipients.forEach((contact) => {
          let iconHtml;
          if (contact.avatar) {
            iconHtml = `<img src="${contact.avatar}" alt="${contact.name}">`;
          } else {
            iconHtml = `${contact.name.charAt(0)}`;
          }
          quickActionsHtml += `<div class="quick-action">
                <div class="quick-action-icon" style="background-color:${
                  contact.avatar ? "transparent" : contact.color || "#6c757d"
                };">${iconHtml}</div>
                <span class="quick-action-label">${contact.name}</span>
            </div>`;
        });
        quickActionsContainer.innerHTML = quickActionsHtml;
        const filteredTransactions = transactions.filter((t) => {
          const searchTerm = query.toLowerCase();
          if (!searchTerm) return true;
          if (t.amount.toString().includes(searchTerm)) return true;
          if (t.type.toLowerCase().includes(searchTerm)) return true;
          if (t.type === "payment" || t.type === "received") {
            const recipientName = t.recipient?.name || "";
            const note = t.note || "";
            return (
              recipientName.toLowerCase().includes(searchTerm) ||
              note.toLowerCase().includes(searchTerm)
            );
          }
          return false;
        });
        if (filteredTransactions.length === 0 && !query) {
          activityListContainer.innerHTML = `<div class="empty-state"><h2>Nothing Here!</h2><p>Your future activity will be organized here</p></div>`;
          return;
        } else if (filteredTransactions.length === 0 && query) {
          activityListContainer.innerHTML = `<div class="empty-state"><h2>No results found</h2><p>Try a different search term.</p></div>`;
          return;
        }
        const groupedTransactions = filteredTransactions.reduce((groups, t) => {
          const groupName = getSmartDateGroup(t.date);
          if (!groups[groupName]) groups[groupName] = [];
          groups[groupName].push(t);
          return groups;
        }, {});
        let html = "";
        for (const dateGroup in groupedTransactions) {
          html += `<div class="date-group-header">${dateGroup}</div><ul class="transaction-list">`;
          groupedTransactions[dateGroup].forEach((t) => {
            let avatar,
              name,
              statusText,
              timeText,
              amount,
              amountClass = "";
            const groupName = getSmartDateGroup(t.date);
            const timeDisplay = new Date(t.date).toLocaleTimeString("en-US", {
              hour: "numeric",
              minute: "2-digit",
              hour12: true,
            });
            const dateDisplay = new Date(t.date).toLocaleDateString("en-US", {
              month: "long",
              day: "numeric",
            });
            timeText =
              groupName === "Today" || groupName === "Yesterday"
                ? timeDisplay
                : dateDisplay;
            switch (t.type) {
              case "payment":
              case "received":
                let party = t.recipient ||
                  contacts.find((c) => c.id == t.contactId) || {
                    name: "Unknown",
                    color: "#6c757d",
                  };
                avatar = party.avatar
                  ? `<img src="${party.avatar}" class="transaction-avatar" />`
                  : `<div class="transaction-avatar" style="background-color:${
                      party.color || "#6c757d"
                    };">${party.name.charAt(0)}</div>`;
                name = party.name;
                statusText =
                  t.status === "pending"
                    ? "Pending"
                    : t.note ||
                      (t.type === "received"
                        ? "Payment received"
                        : "Payment sent");
                amount =
                  t.type === "received"
                    ? `+${formatSimpleCurrency(t.amount)}`
                    : formatSimpleCurrency(t.amount);
                if (t.type === "received") amountClass = "positive";
                break;
              case "add":
                avatar = `<div class="transaction-avatar" style="background-color: var(--accent-green);">$</div>`;
                name = "Add money";
                statusText = `from Chase`;
                amount = formatCurrency(t.amount, true);
                amountClass = "positive";
                break;
              case "withdraw":
                avatar = `<div class="transaction-avatar" style="background-color: var(--accent-green);">$</div>`;
                name = "Withdrawal";
                statusText = `Direct Deposit`;
                amount = formatSimpleCurrency(t.totalDeducted);
                break;
            }
            html += `<li class="transaction-item" data-id="${t.id}">${avatar}<div class="transaction-details"><span class="transaction-name">${name}</span><span class="transaction-status">${statusText}</span><span class="transaction-time">${timeText}</span></div><div class="transaction-amount ${amountClass}">${amount}</div></li>`;
          });
          html += "</ul>";
        }
        activityListContainer.innerHTML = html;
      }
      function renderTransactionDetails(transactionId) {
        const transactions =
          JSON.parse(localStorage.getItem(transactionsKey)) || [];
        const transaction = transactions.find((t) => t.id == transactionId);
        if (!transaction) return;
        switch (transaction.type) {
          case "payment":
          case "received":
            renderPaymentDetails(transaction);
            break;
          case "add":
            renderAddMoneyDetails(transaction);
            break;
          case "withdraw":
            renderWithdrawalDetails(transaction);
            break;
        }
      }
      function renderPaymentDetails(transaction) {
        const userProfile =
          JSON.parse(localStorage.getItem(userProfileKey)) || defaultProfile;
        const recipient = transaction.recipient || {
          name: "Unknown",
          color: "#6c757d",
        };
        let avatarHtml = recipient.avatar
          ? `<img src="${recipient.avatar}" class="td-avatar" alt="${recipient.name}">`
          : `<div class="td-avatar" style="background-color:${
              recipient.color || "#6c757d"
            };">${recipient.name.charAt(0)}</div>`;
        const time = new Date(transaction.date).toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit",
          hour12: true,
        });
        const noteHtml =
          transaction.status === "pending"
            ? `<p class="td-note">For pending payment request $50 to completed</p>`
            : transaction.note
            ? `<p class="td-note">${transaction.note}</p>`
            : "";
        const closeIcon = createThemeableIcon("close.png");
        let detailsHtml = `<div class="details-inner-container">
                <header class="details-header"><button class="details-close-btn" id="details-close-btn">${closeIcon}</button></header>
                <main class="details-content">
                    <section class="td-recipient-info">
                        ${avatarHtml}
                        <h1 class="td-recipient-name">${recipient.name}</h1>
                        <p class="td-timestamp">Today at ${time}</p>
                        ${noteHtml}
                    </section>
                    <section class="td-amount-section"><p class="td-amount">${formatCurrency(
                      transaction.amount,
                      false
                    )}</p></section>`;
        const docIcon = createThemeableIcon("doc.png");
        const reportIcon = createThemeableIcon("report.png");
        const chatIcon = createThemeableIcon("chat.png");
        const chevronIcon = `<svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"></path></svg>`;
        if (transaction.status === "pending") {
          const cancelIcon = createThemeableIcon("block.png");
          const cancelIconWhite = createThemeableIcon("cancel.png", "black");
          const pendingIcon = createThemeableIcon("pending.png");
          detailsHtml += `<hr class="td-divider">
                <section class="td-list-section">
                    <h2 class="td-list-header">Transaction details</h2>
                    <div class="td-detail-item"><div class="td-icon">${pendingIcon}</div><div class="td-text-content"><p class="td-title">Pending</p><p class="td-subtitle">Payment has not settled yet</p></div></div>
                </section>
                <hr class="td-divider">
                <section class="td-actions-section">
                    <h2 class="td-actions-header">What you can do</h2>
                    <div class="td-action-item"><div class="td-action-icon">${cancelIcon}</div><div class="td-action-label">Cancel payment</div><div class="td-action-chevron">${chevronIcon}</div></div>
                    <div class="td-action-item"><div class="td-action-icon">${docIcon}</div><div class="td-action-label">View all ${
            recipient.name.split(" ")[0]
          } transactions</div><div class="td-action-chevron">${chevronIcon}</div></div>
                    <div class="td-action-item"><div class="td-action-icon">${reportIcon}</div><div class="td-action-label">Report a missing offer</div><div class="td-action-chevron">${chevronIcon}</div></div>
                    <div class="td-action-item"><div class="td-action-icon">${chatIcon}</div><div class="td-action-label">Contact Support</div><div class="td-action-chevron">${chevronIcon}</div></div>
                </section>
                 <footer class="td-footer-info">
                    <p><strong>Block, Inc.</strong></p><p>1955 Broadway, Suite 500</p><p>Oakland, CA 94612</p>
                    <p>(800) 969-1940</p><p>NMLS #: 986264</p>
                </footer>
                <footer class="td-footer-button-wrapper"><button class="td-cancel-button" data-id="${
                  transaction.id
                }" id="td-cancel-btn">${cancelIconWhite} Cancel Payment</button></footer>`;
        } else {
          const personIcon = createThemeableIcon("person.png");
          const copyIcon = createThemeableIcon("copy.png");
          const feesIcon = createThemeableIcon("fees.png");
          const infoIcon = createThemeableIcon("info.png");
          const completeIcon = createThemeableIcon("check24_Normal_Normal.png");
          const completeSubtitle =
            transaction.type === "received"
              ? "Payment received successfully"
              : "Payment sent successfully";
          detailsHtml += `<hr class="td-divider">
              <section class="td-list-section">
                <h2 class="td-list-header">Transaction details</h2>
                <div class="td-detail-item"><div class="td-icon">${completeIcon}</div><div class="td-text-content"><p class="td-title">Complete</p><p class="td-subtitle">${completeSubtitle}</p></div></div>
                <div class="td-detail-item"><div class="td-icon">${personIcon}</div><div class="td-text-content"><p class="td-title">Payment between</p><p class="td-subtitle">To: ${
            recipient.name
          }</p><p class="td-subtitle">From: ${
            userProfile.fullName
          }</p></div></div>
                <div class="td-detail-item"><div class="td-icon">$</div><div class="td-text-content"><p class="td-title">Payment Source</p><p class="td-subtitle">Cash balance</p></div></div>
                <div class="td-detail-item"><div class="td-icon">${feesIcon}</div><div class="td-text-content"><p class="td-title">Fees</p><p class="td-subtitle">None applied</p></div><div class="td-icon-right">${infoIcon}</div></div>
                <div class="td-detail-item"><div class="td-icon">#</div><div class="td-text-content"><p class="td-title">Transaction number</p><p class="td-subtitle">${generateTransactionNumber()}</p></div><div class="td-icon-right">${copyIcon}</div></div>
              </section>
              <hr class="td-divider">
              <section class="td-actions-section">
                <h2 class="td-actions-header">What you can do</h2>
                <div class="td-action-item"><div class="td-action-icon">${docIcon}</div><div class="td-action-label">View all ${
            recipient.name.split(" ")[0]
          }<br>transactions</div><div class="td-action-chevron">${chevronIcon}</div></div>
                <div class="td-action-item"><div class="td-action-icon">${reportIcon}</div><div class="td-action-label">Report a missing offer</div><div class="td-action-chevron">${chevronIcon}</div></div>
                <div class="td-action-item"><div class="td-action-icon">${chatIcon}</div><div class="td-action-label">Contact Support</div><div class="td-action-chevron">${chevronIcon}</div></div>
              </section>
              <footer class="td-footer-info"><p><strong>Block, Inc.</strong></p><p>1955 Broadway, Suite 500</p><p>Oakland, CA 94612</p><p>(800) 969-1940</p><p>NMLS #: 986264</p></footer>`;
        }
        detailsHtml += `</main></div>`;
        detailsOverlay.innerHTML = detailsHtml;
        detailsOverlay.classList.add("show");
        document
          .getElementById("details-close-btn")
          .addEventListener("click", () =>
            detailsOverlay.classList.remove("show")
          );
        if (transaction.status === "pending") {
          document
            .getElementById("td-cancel-btn")
            .addEventListener("click", (e) =>
              cancelPayment(e.currentTarget.dataset.id)
            );
        }
      }
      function renderAddMoneyDetails(transaction) {
        const time = new Date(transaction.date).toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit",
          hour12: true,
        });
        const closeIcon = createThemeableIcon("close.png");
        const chatIcon = createThemeableIcon("chat.png");
        const completeIcon = createThemeableIcon("check24_Normal_Normal.png");
        const transferOutIcon = createThemeableIcon("transfer-out.png");
        detailsOverlay.innerHTML = `<div class="details-inner-container">
                <header class="details-header"><button class="details-close-btn" id="details-close-btn">${closeIcon}</button></header>
                <main class="details-content">
                    <section class="td-recipient-info">
                        <div class="td-avatar" style="background-color: var(--accent-green);">$</div>
                        <h1 class="td-recipient-name">Add money</h1>
                        <p class="td-timestamp">Today at ${time}</p>
                    </section>
                    <section class="td-amount-section"><p class="td-amount">+ ${formatCurrency(
                      transaction.amount,
                      false
                    ).replace("$-", "$")}</p></section>
                    <hr class="td-divider">
                    <section class="td-list-section">
                        <h2 class="td-list-header">Transaction details</h2>
                        <div class="td-detail-item"><div class="td-icon">${completeIcon}</div><div class="td-text-content"><p class="td-title">Complete</p><p class="td-subtitle">Transfer from Visa Debit 8885</p></div></div>
                        <div class="td-detail-item"><div class="td-icon">$</div><div class="td-text-content"><p class="td-title">Transferred from</p><p class="td-subtitle">Visa Debit 8885</p></div></div>
                        <div class="td-detail-item"><div class="td-icon">${transferOutIcon}</div><div class="td-text-content"><p class="td-title">Transferred to</p><p class="td-subtitle">Cash balance</p></div></div>
                    </section>
                    <hr class="td-divider">
                    <section class="td-actions-section">
                        <h2 class="td-actions-header">What you can do</h2>
                        <div class="td-action-item"><div class="td-action-icon">${chatIcon}</div><div class="td-action-label">Contact Support</div></div>
                    </section>
                    <footer class="td-footer-info"><p><strong>Block, Inc.</strong></p><p>1955 Broadway, Suite 500</p><p>Oakland, CA 94612</p><p>(800) 969-1940</p><p>NMLS #: 986264</p></footer>
                </main>
            </div>`;
        detailsOverlay.classList.add("show");
        document
          .getElementById("details-close-btn")
          .addEventListener("click", () =>
            detailsOverlay.classList.remove("show")
          );
      }
      function renderWithdrawalDetails(transaction) {
        const time = new Date(transaction.date).toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit",
          hour12: true,
        });
        const closeIcon = createThemeableIcon("close.png");
        const lightningIcon = createThemeableIcon("lightning.png");
        const transferOutIcon = createThemeableIcon("transfer-out.png");
        const feeIcon = createThemeableIcon("percent.png");
        const chatIcon = createThemeableIcon("chat.png");
        detailsOverlay.innerHTML = `<div class="details-inner-container">
                <header class="details-header"><button class="details-close-btn" id="details-close-btn">${closeIcon}</button></header>
                <main class="details-content">
                    <section class="td-recipient-info">
                        <div class="td-avatar" style="background-color: var(--accent-green);">$</div>
                        <h1 class="td-recipient-name">Withdrawal</h1>
                        <p class="td-timestamp">Today at ${time}</p>
                    </section>
                    <section class="td-amount-section"><p class="td-amount">${formatCurrency(
                      transaction.totalDeducted,
                      false
                    )}</p></section>
                    <hr class="td-divider">
                    <section class="td-list-section">
                        <h2 class="td-list-header">Transaction details</h2>
                        <div class="td-detail-item"><div class="td-icon">${lightningIcon}</div><div class="td-text-content"><p class="td-title">Instantly transferred</p><p class="td-subtitle">Funds transferred to your external bank</p></div></div>
                        <div class="td-detail-item"><div class="td-icon">${feeIcon}</div><div class="td-text-content"><p class="td-title">Instant transfer fee</p><p class="td-subtitle">${formatCurrency(
          transaction.fee,
          false
        )}</p></div></div>
                        <div class="td-detail-item"><div class="td-icon">$</div><div class="td-text-content"><p class="td-title">Amount transferred</p><p class="td-subtitle">${formatCurrency(
                          transaction.amount,
                          false
                        )}</p></div></div>
                        <div class="td-detail-item"><div class="td-icon">$</div><div class="td-text-content"><p class="td-title">Transferred from</p><p class="td-subtitle">Cash Balance</p></div></div>
                        <div class="td-detail-item"><div class="td-icon">${transferOutIcon}</div><div class="td-text-content"><p class="td-title">Transferred to</p><p class="td-subtitle">PRIVATE LABEL Debit 9389</p></div></div>
                    </section>
                    <hr class="td-divider">
                    <section class="td-actions-section">
                        <h2 class="td-actions-header">What you can do</h2>
                        <div class="td-action-item"><div class="td-action-icon">${chatIcon}</div><div class="td-action-label">Contact Support</div></div>
                    </section>
                    <footer class="td-footer-info"><p><strong>Block, Inc.</strong></p><p>1955 Broadway, Suite 500</p><p>Oakland, CA 94612</p><p>(800) 969-1940</p><p>NMLS #: 986264</p></footer>
                </main>
            </div>`;
        detailsOverlay.classList.add("show");
        document
          .getElementById("details-close-btn")
          .addEventListener("click", () =>
            detailsOverlay.classList.remove("show")
          );
      }
      function cancelPayment(id) {
        if (!id) return;
        let transactions =
          JSON.parse(localStorage.getItem(transactionsKey)) || [];
        transactions = transactions.filter((t) => t.id != id);
        localStorage.setItem(transactionsKey, JSON.stringify(transactions));
        detailsOverlay.classList.remove("show");
        renderActivity(searchInput.value);
      }
      document.addEventListener("DOMContentLoaded", () => {
        const savedProfileJSON = localStorage.getItem(userProfileKey);
        const userProfile = savedProfileJSON
          ? JSON.parse(savedProfileJSON)
          : initializeUserProfile();
        profileIconLink.innerHTML = generateProfileIcon(userProfile);
        renderActivity();
        searchInput.addEventListener("input", () =>
          renderActivity(searchInput.value)
        );
        activityListContainer.addEventListener("click", (e) => {
          const item = e.target.closest(".transaction-item");
          if (item && item.dataset.id) {
            renderTransactionDetails(item.dataset.id);
          }
        });
      });
    </script>
    <script src="footer.display.js"></script>
    <script src="theme-switcher.js"></script>
  </body>
</html>
